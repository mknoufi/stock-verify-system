<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lavanya E-Mart - Stock Verification System</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #0a0a0a;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      border-bottom: 2px solid #4CAF50;
    }
    .header h1 {
      font-size: 28px;
      font-weight: bold;
      color: #fff;
      margin-bottom: 5px;
    }
    .header p {
      color: #4CAF50;
      font-size: 14px;
    }

    /* Container */
    .container {
      flex: 1;
      padding: 40px 20px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    /* Welcome Section */
    .welcome {
      text-align: center;
      margin-bottom: 50px;
    }
    .welcome h2 {
      font-size: 42px;
      margin-bottom: 15px;
      color: #fff;
    }
    .welcome p {
      font-size: 18px;
      color: #aaa;
    }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .card {
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      border-radius: 12px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #333;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .card:hover {
      transform: translateY(-5px);
      border-color: #4CAF50;
      box-shadow: 0 8px 16px rgba(76, 175, 80, 0.2);
    }

    .card-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .card h3 {
      font-size: 22px;
      margin-bottom: 10px;
      color: #4CAF50;
    }

    .card p {
      color: #bbb;
      font-size: 14px;
      line-height: 1.6;
    }

    /* Status Section */
    .status-section {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 25px;
      border: 2px solid #333;
    }

    .status-section h3 {
      color: #4CAF50;
      margin-bottom: 20px;
      font-size: 20px;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .status-item {
      background: #0a0a0a;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }

    .status-label {
      color: #888;
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .status-value {
      color: #fff;
      font-size: 18px;
      font-weight: bold;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-online {
      background: #4CAF50;
      color: #fff;
    }

    .status-offline {
      background: #f44336;
      color: #fff;
    }

    /* Footer */
    .footer {
      background: #1a1a1a;
      padding: 20px;
      text-align: center;
      color: #888;
      border-top: 1px solid #333;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      border: 2px solid #4CAF50;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      cursor: pointer;
      color: #888;
    }

    .modal-close:hover {
      color: #4CAF50;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #4CAF50;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #333;
      background: #0a0a0a;
      color: #fff;
      font-size: 16px;
    }

    .form-group input:focus {
      outline: none;
      border-color: #4CAF50;
    }

    .btn {
      padding: 12px 30px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #4CAF50;
      color: #fff;
      width: 100%;
    }

    .btn-primary:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>‚úÖ Lavanya E-Mart</h1>
    <p>Stock Verification System - Web Dashboard</p>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Welcome Section -->
    <div class="welcome">
      <h2>Welcome to Stock Management</h2>
      <p>Manage your inventory efficiently with our comprehensive system</p>
    </div>

    <!-- Feature Cards -->
    <div class="cards-grid">
      <div class="card" onclick="openLogin()">
        <div class="card-icon">üë§</div>
        <h3>Staff Login</h3>
        <p>Access your account to start stock verification and management tasks</p>
      </div>

      <div class="card" onclick="openSupervisor()">
        <div class="card-icon">üìä</div>
        <h3>Supervisor Dashboard</h3>
        <p>View analytics, reports, and manage team activities</p>
      </div>

      <div class="card" onclick="openBarcode()">
        <div class="card-icon">üì¶</div>
        <h3>Barcode Scanner</h3>
        <p>Scan product barcodes for quick stock verification</p>
      </div>

      <div class="card" onclick="openInventory()">
        <div class="card-icon">üìã</div>
        <h3>Inventory List</h3>
        <p>Browse and search your complete product inventory</p>
      </div>

      <div class="card" onclick="openReports()">
        <div class="card-icon">üìà</div>
        <h3>Reports</h3>
        <p>Generate and view detailed stock reports and analytics</p>
      </div>

      <div class="card" onclick="openSettings()">
        <div class="card-icon">‚öôÔ∏è</div>
        <h3>Settings</h3>
        <p>Configure system preferences and account settings</p>
      </div>
    </div>

    <!-- System Status -->
    <div class="status-section">
      <h3>üîß System Status</h3>
      <div class="status-grid">
        <div class="status-item">
          <div class="status-label">Backend API</div>
          <div class="status-value">
            <span class="status-badge status-online" id="apiStatus">‚óè ONLINE</span>
          </div>
        </div>
        <div class="status-item">
          <div class="status-label">MongoDB</div>
          <div class="status-value">
            <span class="status-badge status-online" id="mongoStatus">‚óè CONNECTED</span>
          </div>
        </div>
        <div class="status-item">
          <div class="status-label">SQL Server</div>
          <div class="status-value">
            <span class="status-badge status-online" id="sqlStatus">‚óè CONNECTED</span>
          </div>
        </div>
        <div class="status-item">
          <div class="status-label">Total Products</div>
          <div class="status-value" id="productCount">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>¬© 2025 Lavanya E-Mart | Stock Verification System v1.0 | Web Version</p>
    <p style="margin-top: 8px; color: #4CAF50; font-size: 12px;">
      üí° For full features including barcode scanning, use the mobile app with Expo Go
    </p>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
      <h2 style="color: #4CAF50; margin-bottom: 25px;">üë§ Staff Login</h2>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label>Employee ID</label>
          <input type="text" id="employeeId" placeholder="Enter your employee ID" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Global port mapping cache
    let portMapping = {
      backend: { port: 8000, url: 'http://localhost:8000' },
      mongodb: { port: 27017, is_running: false, status: 'unknown' }
    };

    // Load port mapping dynamically
    async function loadPortMapping() {
      try {
        const response = await fetch('/backend_port.json');
        if (response.ok) {
          const data = await response.json();
          portMapping = {
            backend: {
              port: data.port || 8000,
              url: data.url || `http://localhost:${data.port || 8000}`,
              host: data.host || 'localhost'
            },
            mongodb: data.mongodb || {
              port: 27017,
              is_running: false,
              url: 'mongodb://localhost:27017',
              status: 'unknown'
            }
          };
          console.log('üì° Port mapping loaded:', portMapping);

          // Update MongoDB status display
          if (portMapping.mongodb) {
            const mongoStatusEl = document.getElementById('mongoStatus');
            if (mongoStatusEl) {
              if (portMapping.mongodb.is_running) {
                mongoStatusEl.textContent = `‚óè RUNNING (Port ${portMapping.mongodb.port})`;
                mongoStatusEl.className = 'status-badge status-online';
              } else {
                mongoStatusEl.textContent = '‚óè NOT RUNNING';
                mongoStatusEl.className = 'status-badge status-offline';
              }
            }
          }
        }
      } catch (e) {
        console.warn('Could not load port mapping, using defaults:', e);
      }
    }

    // Check API Status
    async function checkAPIStatus() {
      try {
        const response = await fetch(`${portMapping.backend.url}/health`);
        const data = await response.json();
        document.getElementById('apiStatus').textContent = `‚óè ONLINE (Port ${portMapping.backend.port})`;
        document.getElementById('apiStatus').className = 'status-badge status-online';

        // Update MongoDB status from health response if available
        if (data.mongodb && document.getElementById('mongoStatus')) {
          const mongoEl = document.getElementById('mongoStatus');
          if (data.mongodb.is_running) {
            mongoEl.textContent = `‚óè RUNNING (Port ${data.mongodb.port})`;
            mongoEl.className = 'status-badge status-online';
          } else {
            mongoEl.textContent = '‚óè NOT RUNNING';
            mongoEl.className = 'status-badge status-offline';
          }
        }
      } catch (error) {
        document.getElementById('apiStatus').textContent = '‚óè OFFLINE';
        document.getElementById('apiStatus').className = 'status-badge status-offline';
      }
    }

    // Get product count
    async function getProductCount() {
      try {
        // Note: /api/products/count is a demo endpoint ‚Äì implement or remove for production
        const response = await fetch(`${portMapping.backend.url}/api/erp/items?page=1&page_size=1`);
        const data = await response.json();
        const total = data.pagination?.total || 0;
        document.getElementById('productCount').textContent = total || 'N/A';
      } catch (error) {
        document.getElementById('productCount').textContent = 'N/A';
      }
    }

    // Modal functions
    function openLogin() {
      // Redirect to React Native web app's login page
      window.location.href = 'http://localhost:19006/login';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function openSupervisor() {
      // Redirect to React Native web app's supervisor dashboard
      window.location.href = 'http://localhost:19006/supervisor/dashboard';
    }

    function openBarcode() {
      alert('üì¶ Barcode Scanner\n\nWeb browsers have limited camera access.\nFor full barcode scanning, please use the mobile app with Expo Go.');
    }

    function openInventory() {
      alert('üìã Inventory List\n\n(Demo only ‚Äì implement inventory routes for production)');
      // window.location.href = 'http://localhost:8000/inventory';
    }

    function openReports() {
      alert('üìà Reports\n\n(Demo only ‚Äì implement reports routes for production)');
      // window.location.href = 'http://localhost:8000/reports';
    }

    function openSettings() {
      alert('‚öôÔ∏è Settings\n\n(Demo only ‚Äì implement settings routes for production)');
      // window.location.href = 'http://localhost:8000/settings';
    }

    // Handle login
    async function handleLogin(event) {
      event.preventDefault();
      const employeeId = document.getElementById('employeeId').value;
      const password = document.getElementById('password').value;

      try {
        const response = await fetch(`${portMapping.backend.url}/api/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            username: employeeId,
            password: password
          })
        });

        if (response.ok) {
          const data = await response.json();
          alert('‚úÖ Login Successful!\n\nWelcome, ' + (data.user?.full_name || data.user?.username || employeeId));
          closeModal('loginModal');
          // Store token and redirect to dashboard
          localStorage.setItem('authToken', data.access_token);
          // Note: Dashboard routes are demo-only; implement backend routes for production
        } else {
          const errorData = await response.json();
          alert('‚ùå Login Failed\n\n' + (errorData.detail?.message || errorData.detail || 'Invalid credentials'));
        }
      } catch (error) {
        alert(`‚ùå Connection Error\n\nCannot connect to backend server at ${portMapping.backend.url}.\nPlease ensure the backend is running.`);
      }
    }

    // Close modal on outside click
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.classList.remove('active');
      }
    }

    // Initialize
    window.onload = async function() {
      // Load port mapping first
      await loadPortMapping();
      checkAPIStatus();
      getProductCount();
      // Refresh status every 30 seconds
      setInterval(checkAPIStatus, 30000);
      // Refresh port mapping every 60 seconds (in case backend restarts)
      setInterval(loadPortMapping, 60000);
    }
  </script>
</body>
</html>
