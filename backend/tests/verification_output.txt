WARNING:backend.config:MongoDB port detection failed, using default: No module named 'utils.port_detector'
INFO:backend.services.database_optimizer:Database optimizer configured: max_pool=100, min_pool=10, timeouts=5000ms/20000ms
INFO:backend.server:Password hashing: Using Argon2 with bcrypt fallback
INFO:backend.services.cache_service:Redis client created (pending connection verification)
INFO:backend.server:âœ“ Security headers middleware enabled
INFO:backend.server:âœ“ Enrichment API router registered
INFO:backend.server:âœ“ API v2 router registered
INFO:backend.server:ğŸš€ Starting application...
WARNING:backend.server:SQL Server credentials not configured. Set SQL_SERVER_HOST and SQL_SERVER_DATABASE in .env
INFO:backend.server:âœ… MongoDB connection verified - MongoDB is required and available
INFO:backend.server:OK: Default users initialized
INFO:backend.db.migrations:Creating database indexes...
INFO:backend.db.migrations:âœ“ Refresh tokens indexes created
INFO:backend.db.migrations:âœ“ Users indexes created
INFO:backend.db.migrations:âœ“ Sessions indexes created
INFO:backend.db.migrations:âœ“ Count lines indexes created
INFO:backend.db.migrations:âœ“ Text index already exists, skipping
INFO:backend.db.migrations:âœ“ ERP items indexes created
INFO:backend.db.migrations:âœ“ Item variances indexes created
INFO:backend.db.migrations:âœ“ ERP config indexes created
INFO:backend.db.migrations:âœ“ Sync metadata indexes created
INFO:backend.db.migrations:âœ“ Activity logs indexes created
INFO:backend.db.migrations:All database indexes created successfully
INFO:backend.db.migrations:Checking for pending migrations...
INFO:backend.db.migrations:No pending migrations
INFO:backend.server:OK: Migrations completed
INFO:backend.services.auto_sync_manager:ğŸš€ Starting auto-sync manager...
INFO:backend.services.auto_sync_manager:âœ… Auto-sync manager started
INFO:backend.server:âœ… Auto-sync manager started
INFO:backend.services.database_health:Database health monitoring started (interval: 60s)
INFO:backend.server:OK: Database health monitoring started
WARNING:backend.services.cache_service:Redis connection failed: Authentication required.
INFO:backend.server:OK: Cache service initialized: memory
INFO:backend.auth.dependencies:âœ“ AuthDependencies initialized successfully
INFO:backend.server:OK: Auth dependencies initialized
INFO:backend.services.scheduled_export_service:Scheduled export service started
INFO:backend.server:âœ“ Scheduled export service started
INFO:backend.server:âœ“ Enrichment service initialized
INFO:backend.server:âœ“ Sync conflicts service initialized
INFO:backend.server:âœ“ Monitoring service connected to metrics API
INFO:backend.server:âœ“ Item verification API initialized
INFO:backend.services.scheduled_export_service:Scheduled export service started
INFO:backend.server:âœ“ Startup Check: MongoDB connected
INFO:backend.server:â„¹ï¸  Startup Check: SQL Server not configured (optional)
INFO:backend.server:âœ“ Startup Check: Cache initialized (memory)
INFO:backend.server:âœ“ Startup Check: Auth initialized
INFO:backend.server:âœ“ Startup Check: 4 services running
INFO:backend.server:âœ… Startup Checklist: All critical services OK
INFO:backend.server:OK: Application startup complete
INFO:backend.server:=== LOGIN ATTEMPT START ===
INFO:backend.server:Username: admin
INFO:backend.server:Client IP: testclient
INFO:backend.server:Finding user: admin
INFO:backend.server:User found
INFO:backend.server:Verifying password...
INFO:backend.server:Password verified successfully
INFO:backend.server:Generating tokens...
INFO:backend.server:Tokens generated successfully
INFO:backend.server:=== LOGIN SUCCESS ===
INFO:httpx:HTTP Request: POST http://testserver/api/auth/login "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/summary "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/failed-logins "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/suspicious-activity "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/sessions "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/audit-log "HTTP/1.1 200 OK"
INFO:backend.api.security_api:Checking admin role for user: admin, role: admin
INFO:httpx:HTTP Request: GET http://testserver/api/admin/security/ip-tracking "HTTP/1.1 200 OK"
INFO:backend.server:ğŸ›‘ Shutting down application...
INFO:backend.services.auto_sync_manager:Stopping auto-sync manager...
INFO:backend.services.scheduled_export_service:Scheduled export service stopped
INFO:backend.server:âœ“ Scheduled export service stopped
INFO:backend.services.database_health:Database health monitoring stopped
INFO:backend.server:âœ“ Database health monitoring stopped
INFO:backend.services.auto_sync_manager:âœ… Auto-sync manager stopped
INFO:backend.server:âœ… Auto-sync manager stopped
INFO:backend.server:âœ“ MongoDB connection closed
INFO:backend.server:âœ“ Application shutdown complete (took 0.00s)
ğŸ”§ Fixing admin user role...
â„¹ï¸  Admin role already correct
ğŸ”’ Verifying Security Dashboard API...

1. Authenticating as Admin...
âœ… Login successful

2. Verifying Security Summary...
âœ… Security Summary OK
   - Failed Logins: 1
   - Active Sessions: 97

3. Verifying Failed Logins...
âœ… Failed Logins OK

4. Verifying Suspicious Activity...
âœ… Suspicious Activity OK

5. Verifying Sessions...
âœ… Sessions OK

6. Verifying Audit Log...
âœ… Audit Log OK

7. Verifying IP Tracking...
âœ… IP Tracking OK

âœ¨ Verification Complete!
